var results = {
  "results_found": 45,
  "results_start": 0,
  "results_shown": 20,
  "restaurants": [
    {
      "restaurant": {
        "R": {
          "res_id": 16918377
        },
        "apikey": "be022f80f221175a3c2f9151cc5b9fa6",
        "id": "16918377",
        "name": "Zarab's Kabobs",
        "url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "location": {
          "address": "2001 Guadalupe Street, TX 78705",
          "locality": "University of Texas",
          "city": "Austin",
          "city_id": 278,
          "latitude": "30.2829055556",
          "longitude": "-97.7419805556",
          "zipcode": "78705",
          "country_id": 216
        },
        "cuisines": "Kebab, Pakistani, Indian",
        "average_cost_for_two": 25,
        "price_range": 1,
        "currency": "$",
        "offers": [],
        "thumb": "https://b.zmtcdn.com/data/pictures/7/16918377/28ae6997cdefedfe4e63517ac3f95851_featured_v2.jpg",
        "user_rating": {
          "aggregate_rating": "0",
          "rating_text": "Not rated",
          "rating_color": "CBCBC8",
          "votes": "1"
        },
        "photos_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/photos#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "menu_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/menu#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "featured_image": "https://b.zmtcdn.com/data/pictures/7/16918377/28ae6997cdefedfe4e63517ac3f95851_featured_v2.jpg",
        "has_online_delivery": 0,
        "is_delivering_now": 0,
        "deeplink": "zomato://r/16918377",
        "has_table_booking": 0,
        "events_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "establishment_types": []
      }
    },
     {
      "restaurant": {
        "R": {
          "res_id": 16918377
        },
        "apikey": "be022f80f221175a3c2f9151cc5b9fa6",
        "id": "16918377",
        "name": "Zarab's Kabobs",
        "url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "location": {
          "address": "2001 Guadalupe Street, TX 78705",
          "locality": "University of Texas",
          "city": "Austin",
          "city_id": 278,
          "latitude": "30.2829055556",
          "longitude": "-97.7419805556",
          "zipcode": "78705",
          "country_id": 216
        },
        "cuisines": "Kebab, Pakistani, Indian",
        "average_cost_for_two": 25,
        "price_range": 1,
        "currency": "$",
        "offers": [],
        "thumb": "https://b.zmtcdn.com/data/pictures/7/16918377/28ae6997cdefedfe4e63517ac3f95851_featured_v2.jpg",
        "user_rating": {
          "aggregate_rating": "0",
          "rating_text": "Not rated",
          "rating_color": "CBCBC8",
          "votes": "1"
        },
        "photos_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/photos#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "menu_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/menu#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "featured_image": "https://b.zmtcdn.com/data/pictures/7/16918377/28ae6997cdefedfe4e63517ac3f95851_featured_v2.jpg",
        "has_online_delivery": 0,
        "is_delivering_now": 0,
        "deeplink": "zomato://r/16918377",
        "has_table_booking": 0,
        "events_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "establishment_types": []
      }
    },
     {
      "restaurant": {
        "R": {
          "res_id": 16918377
        },
        "apikey": "be022f80f221175a3c2f9151cc5b9fa6",
        "id": "16918377",
        "name": "Zarab's Kabobs",
        "url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "location": {
          "address": "2001 Guadalupe Street, TX 78705",
          "locality": "University of Texas",
          "city": "Austin",
          "city_id": 278,
          "latitude": "30.2829055556",
          "longitude": "-97.7419805556",
          "zipcode": "78705",
          "country_id": 216
        },
        "cuisines": "Kebab, Pakistani, Indian",
        "average_cost_for_two": 25,
        "price_range": 1,
        "currency": "$",
        "offers": [],
        "thumb": "https://b.zmtcdn.com/data/pictures/7/16918377/28ae6997cdefedfe4e63517ac3f95851_featured_v2.jpg",
        "user_rating": {
          "aggregate_rating": "0",
          "rating_text": "Not rated",
          "rating_color": "CBCBC8",
          "votes": "1"
        },
        "photos_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/photos#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "menu_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/menu#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "featured_image": "https://b.zmtcdn.com/data/pictures/7/16918377/28ae6997cdefedfe4e63517ac3f95851_featured_v2.jpg",
        "has_online_delivery": 0,
        "is_delivering_now": 0,
        "deeplink": "zomato://r/16918377",
        "has_table_booking": 0,
        "events_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "establishment_types": []
      }
    },
     {
      "restaurant": {
        "R": {
          "res_id": 16918377
        },
        "apikey": "be022f80f221175a3c2f9151cc5b9fa6",
        "id": "16918377",
        "name": "Zarab's Kabobs",
        "url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "location": {
          "address": "2001 Guadalupe Street, TX 78705",
          "locality": "University of Texas",
          "city": "Austin",
          "city_id": 278,
          "latitude": "30.2829055556",
          "longitude": "-97.7419805556",
          "zipcode": "78705",
          "country_id": 216
        },
        "cuisines": "Kebab, Pakistani, Indian",
        "average_cost_for_two": 25,
        "price_range": 1,
        "currency": "$",
        "offers": [],
        "thumb": "https://b.zmtcdn.com/data/pictures/7/16918377/28ae6997cdefedfe4e63517ac3f95851_featured_v2.jpg",
        "user_rating": {
          "aggregate_rating": "0",
          "rating_text": "Not rated",
          "rating_color": "CBCBC8",
          "votes": "1"
        },
        "photos_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/photos#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "menu_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/menu#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "featured_image": "https://b.zmtcdn.com/data/pictures/7/16918377/28ae6997cdefedfe4e63517ac3f95851_featured_v2.jpg",
        "has_online_delivery": 0,
        "is_delivering_now": 0,
        "deeplink": "zomato://r/16918377",
        "has_table_booking": 0,
        "events_url": "https://www.zomato.com/austin/zarabs-kabobs-university-of-texas/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "establishment_types": []
      }
    },
    {
      "restaurant": {
        "R": {
          "res_id": 16918399
        },
        "apikey": "be022f80f221175a3c2f9151cc5b9fa6",
        "id": "16918399",
        "name": "Nasha",
        "url": "https://www.zomato.com/austin/nasha-rosewood?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "location": {
          "address": "1614 E 7th Street, TX 78702",
          "locality": "Rosewood",
          "city": "Austin",
          "city_id": 278,
          "latitude": "30.2636027778",
          "longitude": "-97.7249666667",
          "zipcode": "78702",
          "country_id": 216
        },
        "cuisines": "Indian",
        "average_cost_for_two": 40,
        "price_range": 2,
        "currency": "$",
        "offers": [],
        "thumb": "https://b.zmtcdn.com/data/pictures/9/16918399/fe0bfde4a423f5547c163645b234629c_featured_v2.jpg",
        "user_rating": {
          "aggregate_rating": "3.0",
          "rating_text": "Average",
          "rating_color": "CDD614",
          "votes": "15"
        },
        "photos_url": "https://www.zomato.com/austin/nasha-rosewood/photos#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "menu_url": "https://www.zomato.com/austin/nasha-rosewood/menu#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "featured_image": "https://b.zmtcdn.com/data/pictures/9/16918399/fe0bfde4a423f5547c163645b234629c_featured_v2.jpg",
        "has_online_delivery": 0,
        "is_delivering_now": 0,
        "deeplink": "zomato://r/16918399",
        "has_table_booking": 0,
        "events_url": "https://www.zomato.com/austin/nasha-rosewood/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "establishment_types": []
      }
    },
    {
      "restaurant": {
        "R": {
          "res_id": 16917132
        },
        "apikey": "be022f80f221175a3c2f9151cc5b9fa6",
        "id": "16917132",
        "name": "Gandhi Bazar",
        "url": "https://www.zomato.com/austin/gandhi-bazar-sunset-valley?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "location": {
          "address": "3421 W William Cannon Drive, Suite 133, Austin, TX 78745",
          "locality": "Sunset Valley",
          "city": "Austin",
          "city_id": 278,
          "latitude": "30.2129341000",
          "longitude": "-97.8295162000",
          "zipcode": "78745",
          "country_id": 216
        },
        "cuisines": "Indian",
        "average_cost_for_two": 40,
        "price_range": 2,
        "currency": "$",
        "offers": [],
        "thumb": "https://b.zmtcdn.com/data/pictures/chains/2/16917132/5721bd5b872302d26529d7691b66c012_featured_v2.jpg",
        "user_rating": {
          "aggregate_rating": "2.8",
          "rating_text": "Average",
          "rating_color": "FFBA00",
          "votes": "8"
        },
        "photos_url": "https://www.zomato.com/austin/gandhi-bazar-sunset-valley/photos#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "menu_url": "https://www.zomato.com/austin/gandhi-bazar-sunset-valley/menu#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "featured_image": "https://b.zmtcdn.com/data/pictures/chains/2/16917132/5721bd5b872302d26529d7691b66c012_featured_v2.jpg",
        "has_online_delivery": 0,
        "is_delivering_now": 0,
        "deeplink": "zomato://r/16917132",
        "has_table_booking": 0,
        "events_url": "https://www.zomato.com/austin/gandhi-bazar-sunset-valley/events#tabtop?utm_source=api_basic_user&utm_medium=api&utm_campaign=v2.1",
        "establishment_types": []
      }
    }
]
}



var config = {
    apiKey: "AIzaSyBR4RRXzXAxwSX0VO6WeT2LkyKyy-s_anc",
    authDomain: "which-wine-14da9.firebaseapp.com",
    databaseURL: "https://which-wine-14da9.firebaseio.com",
    storageBucket: "",
  };
  firebase.initializeApp(config);

var maxHeight;
var height;

var zomatoQueryUrl = 'https://developers.zomato.com/api/v2.1/search';
var api_key = 'be022f80f221175a3c2f9151cc5b9fa6';
var long, lat, radius, q;

var fire = firebase.database();
var data;
var resultHeightArr = [];
var colHeight;

function firebaseLogin() {
    console.log(data);
}

function showBasicSearch() {
    $('.container-login-modal').hide();
    $('.container-main').show();
    $('.row-basic-search').show();
}
function inputFocus(){
    $('.basic-search-input').focus(function(event) {
        console.log('onfocus ');
        if(($(event.target).val())  == ($(event.target).attr('value'))) {
            $(event.target).val('');
            
        } // name-input focus if
    }); // name-input focus
    $('.basic-search-input').blur(function(event) {
        console.log('onblur ');
        if($(event.target).val()  == '') {
            $(event.target).val($(event.target).attr('value')); 
            
        } //name-input blur if
    }); // name-input blur
} //end nameFocus


function testResponse() {
    $('.row-basic-search').slideUp();
            var resultsArray = results.restaurants;
            console.log('test');
            for(i = 0; i < resultsArray.length; i++) {
                console.log(i);
                var resultsCell = $('<div class="col col-xs-4 col-results">'); //define results cell
                var subResultsCell = $('<div class="inside">');
                subResultsCell.append('<div><img alt="' + resultsArray[i].restaurant.name + '" src="' + resultsArray[i].restaurant.featured_image + '"></div>'); //append featured image
                               subResultsCell.append('<h3>' + resultsArray[i].restaurant.name + '</h3>'); //append restaurant name
                subResultsCell.append('<p>' + resultsArray[i].restaurant.cuisines + '</p>'); //append cuisine
                subResultsCell.append('<p>' + resultsArray[i].restaurant.location.address + '</p>'); //append address
                subResultsCell.append('<p>' + resultsArray[i].restaurant.location.locality + '</p>'); //append locality
                subResultsCell.append('<p>Rating: ' + resultsArray[i].restaurant.user_rating.rating_text + '</p>'); // append rating
              subResultsCell.append('<p>For Two: about $' + resultsArray[i].restaurant.average_cost_for_two + '</p>');  // append price estimate
                menuBtn = $('<button class="btn btn-large btn-brisket">Menu</button>');  //resultsArray[i].restaurant.menu_url
                saveBtn = $('<button class="btn btn-large btn-brisket">Save</button>');
                goBtn = $('<button class="btn btn-large btn-brisket">Go</button>');
                subResultsCell.append(menuBtn);
                subResultsCell.append(saveBtn);
                subResultsCell.append(goBtn);
                resultsCell.append(subResultsCell);
                $('.row-results').show();
                $('.col-result-target').append(resultsCell); // append results cells to row
            }
             setTimeout(resultHeight, 500);
        }


function getIp() {
    $.ajax({
        url: 'http://www.ip-api.com/json'
    }).done(function(resp) {
        console.log(resp);
        lat = resp.lat;
        long = resp.long;
    });
}
function resultHeight() {
    maxHeight = Math.max.apply(null, $('.inside').map(function() {
        console.log(($(this).height()) / ($(this).width()));
        resultHeightArr.push(($(this).height()) / ($(this).width()));
        console.log(resultHeightArr);
    }).get());
    resultHeightArr.sort(function(a, b) {
        return b - a;
    });
    console.log(resultHeightArr);
    colHeight = ($('.col-results').width() * resultHeightArr[0] * 1.1);
    $('.col-results').css({'height': 'calc(' + colHeight + 'px'});
    resultHeightArr = [];
} // end resultHeight

$(document).ready(function() {
    fire.ref().on('value', function(snapshot) {
        data = snapshot.val();
    });
    getIp();
    inputFocus();
    $('.btn-login').click(firebaseLogin);
    $('.btn-nologin').click(showBasicSearch); 
    $('#basic-search-submit').click(testResponse);
    $(window).on('resize', resultHeight);

});

